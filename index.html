<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maya Groom Pro - Mobile Pet Grooming Appointments</title>

    <meta name="theme-color" content="#C7632C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Maya Groom Pro">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-primary: #F5EAD8; --bg-secondary: #FFF8ED; --bg-tertiary: #E8DCC8;
            --text-primary: #2A1F14; --text-secondary: #5A4A3A; --text-tertiary: #8A7A6A;
            --accent-primary: #C7632C; --accent-secondary: #E88D5A; --accent-dark: #9A4A1F;
            --border: #D4C5B3; --success: #6B9F7F; --warning: #D89545; --danger: #D94A3D;
        }
        * { font-family: 'Plus Jakarta Sans', sans-serif; box-sizing: border-box; }
        body { background: var(--bg-primary); color: var(--text-primary); margin: 0; overflow-x: hidden; }
        .hidden { display: none !important; }
        .btn { padding: 0.625rem 1.25rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; border: none; }
        .btn-primary { background: linear-gradient(135deg, var(--accent-primary), var(--accent-dark)); color: white; }
        .input-field { width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1.5px solid var(--border); background: var(--bg-secondary); }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: var(--bg-secondary); border-radius: 1.5rem; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; padding: 1.5rem; }
        .day-timeline { position: relative; min-height: 1152px; background: var(--bg-primary); }
        .timeline-hour { height: 48px; border-bottom: 1px solid var(--border); position: relative; padding-left: 3.5rem; }
        .timeline-hour-label { position: absolute; left: 0.5rem; font-size: 0.75rem; color: var(--text-tertiary); }
        .timeline-appointment { position: absolute; background: rgba(59, 130, 246, 0.1); border-left: 3px solid #3B82F6; border-radius: 0.5rem; padding: 0.5rem; z-index: 10; cursor: pointer; }
    </style>
</head>
<body>
    <header class="sticky top-0 z-50" style="background: var(--bg-secondary); border-bottom: 1px solid var(--border); padding: 0.5rem 1rem; display: flex; justify-content: space-between; align-items: center;">
        <div id="headerLogo" onclick="openLogoUpload()" style="font-weight: bold; color: var(--accent-primary);">MAYA GROOM PRO</div>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
            <span id="syncStatus" style="font-size: 10px; opacity: 0.7;">Not synced</span>
            <button onclick="openSettings()" class="btn" style="background: var(--bg-tertiary); padding: 0.5rem;"><i class="fas fa-gear"></i></button>
        </div>
    </header>

    <main style="height: calc(100vh - 4rem); overflow: hidden; display: flex; flex-direction: column;">
        <div id="scheduleView" class="tab-content" style="flex: 1; display: flex; flex-direction: column;">
            <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 id="currentMonthYear" style="margin: 0;">December 2025</h2>
                    <button onclick="showScheduleMenu()" class="btn-primary" style="border-radius: 50%; width: 32px; height: 32px; padding: 0;">+</button>
                </div>
            </div>
            <div id="timelineScrollContainer" style="flex: 1; overflow-y: auto;">
                <div class="day-timeline" id="dayTimeline"></div>
            </div>
        </div>
    </main>

    <script>
        // --- DATA STATE ---
        let appointments = [];
        let clients = [];
        let services = [];
        let items = [];
        let settings = { businessName: "Maya Groom Pro", use24HourClock: false };

        // --- INITIALIZATION ---
        window.onload = function() {
            loadFromLocalStorage();
            renderDayTimeline();
        };

        function loadFromLocalStorage() {
            const savedApts = localStorage.getItem('maya_appointments');
            if (savedApts) appointments = JSON.parse(savedApts);
            const savedClients = localStorage.getItem('maya_clients');
            if (savedClients) clients = JSON.parse(savedClients);
        }

        function saveToLocalStorage() {
            localStorage.setItem('maya_appointments', JSON.stringify(appointments));
            localStorage.setItem('maya_clients', JSON.stringify(clients));
        }

        // --- UI RENDERING ---
        function renderDayTimeline() {
            const container = document.getElementById('dayTimeline');
            container.innerHTML = '';
            
            // Draw hours
            for (let i = 0; i < 24; i++) {
                const hourRow = document.createElement('div');
                hourRow.className = 'timeline-hour';
                hourRow.innerHTML = `<span class="timeline-hour-label">${i}:00</span>`;
                container.appendChild(hourRow);
            }

            // Draw current day appointments
            const todayStr = new Date().toISOString().split('T')[0];
            appointments.filter(a => a.date.startsWith(todayStr)).forEach(apt => {
                const aptEl = document.createElement('div');
                aptEl.className = 'timeline-appointment';
                const startHour = parseInt(apt.time.split(':')[0]);
                const startMin = parseInt(apt.time.split(':')[1]);
                aptEl.style.top = `${(startHour * 48) + (startMin * 0.8)}px`;
                aptEl.style.height = '60px'; // Default height
                aptEl.style.width = '80%';
                aptEl.style.left = '4rem';
                aptEl.innerHTML = `<strong>${apt.clientName}</strong>`;
                aptEl.onclick = () => openAppointmentDetails(apt.id);
                container.appendChild(aptEl);
            });
        }

        // --- MODALS & MENUS ---
        function showModal(title, html, buttons) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal-content">
                    <h2 style="margin-top:0">${title}</h2>
                    <div style="margin-bottom: 1.5rem">${html}</div>
                    <div style="display: flex; gap: 0.5rem; justify-content: flex-end">${buttons}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function showScheduleMenu() {
            const content = `
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button onclick="closeAllModals(); openNewAppointmentModal();" class="btn" style="text-align: left; background: var(--bg-tertiary);">New Appointment</button>
                    <button onclick="closeAllModals(); exportAllData();" class="btn" style="text-align: left; background: var(--bg-tertiary);">Backup Data</button>
                </div>
            `;
            showModal('Menu', content, '<button onclick="closeAllModals()" class="btn">Cancel</button>');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.remove());
        }

        // --- UTILITIES ---
        function showAlert(msg) {
            alert(msg);
        }

        function exportAllData() {
            const dataStr = JSON.stringify({ clients, appointments, settings });
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `maya-groom-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
    </script>
</body>
</html>
