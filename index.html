<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Maya Groom Pro - Mobile Pet Grooming Appointments</title>

    <!-- Theme colors for mobile browsers and home screen -->
    <meta name="theme-color" content="#C7632C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Maya Groom Pro">

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <!-- FIX 4: Firebase CDN Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<style>
    a.email-link{color:var(--text-primary)!important;text-decoration:none;}
    a.email-link:hover{color:var(--accent-primary)!important;}

        :root {
            --bg-primary: #F5EAD8;
            --bg-secondary: #FFF8ED;
            --bg-tertiary: #E8DCC8;
            --text-primary: #2A1F14;
            --text-secondary: #5A4A3A;
            --text-tertiary: #8A7A6A;
            --accent-primary: #C7632C;
            --accent-secondary: #E88D5A;
            --accent-dark: #9A4A1F;
            --border: #D4C5B3;
            --success: #6B9F7F;
            --warning: #D89545;
            --danger: #D94A3D;
        }

        .dark {
            --bg-primary: #1A1410;
            --bg-secondary: #2A2218;
            --bg-tertiary: #3A3028;
            --text-primary: #F5EAD8;
            --text-secondary: #D4C5B3;
            --text-tertiary: #A89682;
            --border: #4A3F35;
        }

        * {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        html, body {
            height: 100%;
            width: 100%;
            max-width: 100vw;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
            font-size: 16px;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .mono {
            font-family: 'DM Mono', monospace;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-sm {
            padding: 0.5rem 0.875rem;
            font-size: 0.75rem;
        }

        .uniform-tab {
            padding: 0.25rem 0.625rem;
            border-radius: 1rem;
            font-size: 0.688rem;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            min-width: 3.5rem;
            text-align: center;
        }

        .nav-tab {
            background: transparent;
            border: none;
            padding: 0.25rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.125rem;
            cursor: pointer;
            min-width: 0;
        }

        .nav-tab span {
            font-size: 0.625rem;
            font-weight: 600;
        }

        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 1rem;
            transition: all 0.3s;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }

        .input-field {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border-radius: 0.5rem;
            border: 1.5px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.2s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            animation: fadeIn 0.2s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 1.75rem;
            max-width: 90%;
            width: 500px;
            max-height: 75vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s;
            margin-bottom: 6rem;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            font-size: 0.75rem;
        }

        .calendar-day:hover {
            border-color: var(--accent-secondary);
            background: var(--bg-secondary);
        }

        .calendar-day.selected {
            background: var(--accent-primary);
            color: white;
        }

        .calendar-day.has-appointments {
            border-color: var(--accent-primary);
        }

        .appointment-slot {
            padding: 1rem;
            border-radius: 1.25rem;
            border: 1.5px solid var(--border);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .appointment-slot:hover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .tab-button {
            padding: 0.625rem 1rem;
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            font-weight: 600;
            font-size: 0.813rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab-button.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        .badge {
            padding: 0.25rem 0.625rem;
            border-radius: 1rem;
            font-size: 0.688rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .badge-primary {
            background: rgba(236, 72, 153, 0.1);
            color: var(--accent-primary);
        }

        /* Week Navigation Styles */
        .week-days-nav {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.125rem;
            margin-bottom: 0.25rem;
            padding: 0.125rem 0;
        }

        .week-day-item {
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0.0625rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .week-day-label {
            font-size: 0.5625rem;
            color: var(--text-tertiary);
            margin-bottom: 0.0625rem;
            font-weight: 500;
        }

        .week-day-number {
            width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 0.5625rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .week-day-item:hover .week-day-number {
            background: var(--bg-tertiary);
        }

        .week-day-item.selected .week-day-number {
            background: var(--accent-primary);
            color: white;
        }

        .week-day-item.today .week-day-number {
            border: 2px solid var(--accent-primary);
        }

        .week-day-item.selected.today .week-day-number {
            border: none;
        }

        .week-nav-btn {
            background: var(--accent-primary);
            border: none;
            cursor: pointer;
            color: white;
            width: 1.125rem;
            min-width: 1.125rem;
            height: 1.125rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s;
            border-radius: 50%;
            padding: 0.0625rem;
            flex-shrink: 0;
        }

        .week-nav-btn:hover {
            background: var(--accent-dark);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .week-nav-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 640px) {
            .week-day-number {
                width: 1.375rem;
                height: 1.375rem;
                font-size: 0.625rem;
            }

            .week-day-label {
                font-size: 0.5625rem;
            }

            .timeline-hour {
                height: 3.5rem;
            }

            .week-nav-btn {
                width: 1.125rem;
                min-width: 1.125rem;
                height: 1.125rem;
            }
        }

        /* Single Day Timeline */
        .day-timeline {
            position: relative !important;
            touch-action: pan-y;
            min-height: 1152px; /* 24 hours * 48px */
        }

        .timeline-hour {
            height: var(--hour-height, 3rem);
            border-bottom: 1px solid var(--border);
            position: relative;
            display: flex;
            align-items: flex-start;
            padding-left: 3.5rem;
            cursor: pointer;
            transition: background 0.2s, height 0.15s ease-out;
            background-image: linear-gradient(
                to bottom,
                transparent 24.5%,
                var(--border) 24.5%,
                var(--border) 25.5%,
                transparent 25.5%,
                transparent 49.5%,
                var(--border) 49.5%,
                var(--border) 50.5%,
                transparent 50.5%,
                transparent 74.5%,
                var(--border) 74.5%,
                var(--border) 75.5%,
                transparent 75.5%
            );
            background-size: 100% 100%;
            background-position: 3.5rem 0;
        }

        .timeline-hour:hover {
            background-color: var(--bg-tertiary);
        }

        .timeline-hour-label {
            position: absolute;
            left: 0;
            top: 4px;
            font-size: 0.75rem;
            color: var(--text-tertiary);
            font-family: 'DM Mono', monospace;
            width: 3rem;
            text-align: right;
            padding-right: 0.5rem;
            white-space: nowrap;
        }

        .timeline-appointment {
            position: absolute !important;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3B82F6;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            cursor: move;
            transition: all 0.2s;
            touch-action: pinch-zoom;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            font-size: 0.813rem;
            z-index: 10;
            box-sizing: border-box;
            overflow: hidden;
        }

        .timeline-appointment.recurring {
            background: rgba(168, 85, 247, 0.15);
            border-left: 3px solid #A855F7;
        }

        .timeline-appointment.recurring .timeline-appointment-title {
            color: #A855F7;
        }

        .timeline-appointment.completed {
            background: rgba(34, 197, 94, 0.15);
            border-left: 3px solid #22C55E;
        }

        .timeline-appointment.completed .timeline-appointment-title {
            color: #22C55E;
        }

        .timeline-appointment.cancelled {
            background: rgba(239, 68, 68, 0.15);
            border-left: 3px solid #EF4444;
            opacity: 0.6;
        }

        .timeline-appointment.cancelled .timeline-appointment-title {
            color: #EF4444;
            text-decoration: line-through;
        }

        .timeline-appointment:hover {
            background: rgba(59, 130, 246, 0.15);
            transform: translateX(2px);
        }

        .timeline-appointment.recurring:hover {
            background: rgba(168, 85, 247, 0.25);
        }

        .timeline-appointment.dragging {
            opacity: 0.7;
            z-index: 1000;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        .timeline-appointment-title {
            font-weight: 700;
            color: #3B82F6;
            font-size: 0.875rem;
            pointer-events: none;
        }

        /* Current time indicator */
        .current-time-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: #EF4444;
            z-index: 20;
            pointer-events: none;
        }

        .current-time-line::before {
            content: '';
            position: absolute;
            left: 3rem;
            top: -4px;
            width: 10px;
            height: 10px;
            background: #EF4444;
            border-radius: 50%;
        }

        .current-time-label {
            position: absolute;
            left: 0.25rem;
            top: -8px;
            font-size: 0.625rem;
            font-weight: 700;
            color: #EF4444;
            background: var(--bg-primary);
            padding: 0 2px;
        }

        .checkbox-custom {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checkbox-custom.checked {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        @media (max-width: 640px) {
            .modal-content {
                max-width: 95%;
                margin: 1rem;
            }

            .btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.938rem;
            }

            .week-timeline {
                grid-template-columns: 50px repeat(7, 1fr);
            }

            .timeline-day-column {
                min-width: 100px;
            }
        }

        /* Desktop/Laptop optimization */
        @media (min-width: 768px) {
            .modal-content {
                max-width: 600px;
            }

            .app-container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .timeline-appointment {
                font-size: 0.875rem;
                padding: 0.625rem 1rem;
            }

            .timeline-appointment-title {
                font-size: 0.938rem;
            }

            .input-field {
                padding: 0.75rem 1rem;
            }

            .btn {
                padding: 0.75rem 1.5rem;
            }

            .card {
                padding: 1.5rem;
            }

            /* Show zoom hint on desktop */
            .zoom-hint {
                display: block;
                position: fixed;
                bottom: 80px;
                right: 20px;
                background: var(--bg-tertiary);
                padding: 0.5rem 0.75rem;
                border-radius: 0.5rem;
                font-size: 0.75rem;
                color: var(--text-tertiary);
                opacity: 0.8;
                pointer-events: none;
                z-index: 100;
            }
        }

        @media (min-width: 1024px) {
            .modal-content {
                max-width: 700px;
            }

            /* Larger timeline on bigger screens */
            .timeline-hour-row {
                height: 60px;
            }
        }

        /* Utility Classes */
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .grid { display: grid; }
        .hidden { display: none !important; }
        .block { display: block; }
        .inline-block { display: inline-block; }

        .tab-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-end { justify-content: flex-end; }

        .flex-col { flex-direction: column; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-1 { flex: 1; }

        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }

        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .pt-4 { padding-top: 1rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .pb-4 { padding-bottom: 1rem; }
        .pl-3 { padding-left: 0.75rem; }
        .pr-3 { padding-right: 0.75rem; }

        .m-0 { margin: 0; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .mx-4 { margin-left: 1rem; margin-right: 1rem; }
        .my-2 { margin-top: 0.5rem; margin-bottom: 0.5rem; }
        .my-4 { margin-top: 1rem; margin-bottom: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mr-1 { margin-right: 0.25rem; }
        .mr-2 { margin-right: 0.5rem; }
        .ml-2 { margin-left: 0.5rem; }

        .w-full { width: 100%; }
        .w-12 { width: 3rem; }
        .h-12 { height: 3rem; }
        .max-w-7xl { max-width: 80rem; }
        .max-w-sm { max-width: 24rem; }
        .min-w-0 { min-width: 0; }

        .text-xs { font-size: 0.688rem; line-height: 0.875rem; }
        .text-sm { font-size: 0.75rem; line-height: 1rem; }
        .text-base { font-size: 0.875rem; line-height: 1.25rem; }
        .text-lg { font-size: 1rem; line-height: 1.5rem; }
        .text-xl { font-size: 1.125rem; line-height: 1.5rem; }
        .text-2xl { font-size: 1.25rem; line-height: 1.625rem; }
        .text-3xl { font-size: 1.5rem; line-height: 1.875rem; }
        .text-4xl { font-size: 1.75rem; line-height: 2rem; }

        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }

        .text-center { text-align: center; }
        .text-right { text-align: right; }

        .rounded { border-radius: 0.75rem; }
        .rounded-lg { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }

        .border { border-width: 1px; }
        .border-t { border-top-width: 1px; }
        .border-b { border-bottom-width: 1px; }

        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-hidden { overflow: hidden; }

        .cursor-pointer { cursor: pointer; }
        .cursor-move { cursor: move; }

        .sticky { position: sticky; }
        .fixed { position: fixed; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }

        .top-0 { top: 0; }
        .z-50 { z-index: 50; }

        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }

        .opacity-50 { opacity: 0.5; }
        .opacity-70 { opacity: 0.7; }
        .hover\:opacity-70:hover { opacity: 0.7; }
        .hover\:bg-opacity-10:hover { background-opacity: 0.1; }

        .transition-opacity { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 z-50" style="background: var(--bg-secondary); border-bottom: 1px solid var(--border);">
        <div class="px-2 py-1 flex items-center justify-between">
            <div class="flex items-center gap-1">
                <div id="headerLogo" onclick="openLogoUpload()" style="cursor: pointer;">
                    <!-- Logo will be dynamically inserted here -->
                </div>
            </div>
            <div class="flex items-center gap-2">
                <span style="font-size:12px;opacity:.85;">Cloud (ALLUPD-SYNTAXFIX2-20251224-033204-2b40): Cloud: <span id="syncStatus">Not synced</span> <span style="font-size:12px;opacity:.85;margin-left:8px;">Last backup: <span id="lastBackup">â€”</span></span></span><button id="syncBtn" type="button" class="btn btn-secondary" style="padding:0.4rem 0.75rem;border-radius:10px;">Sync</button><button onclick="showBackupModal()" class="p-1.5 rounded-lg hover:bg-opacity-10 relative" style="background: var(--bg-tertiary);" title="Backup & Restore Data">
                    <i class="fas fa-cloud-arrow-up" style="font-size: 0.938rem;"></i>
                    <span id="backupBadge" class="hidden" style="position: absolute; top: -2px; right: -2px; width: 8px; height: 8px; background: var(--danger); border-radius: 50%;"></span>
                </button>
                <button onclick="openSettings()" class="p-1.5 rounded-lg hover:bg-opacity-10" style="background: var(--bg-tertiary);">
                    <i class="fas fa-gear" style="font-size: 0.938rem;"></i>
                </button>
                <button onclick="toggleDarkMode()" class="p-1.5 rounded-lg hover:bg-opacity-10" style="background: var(--bg-tertiary);">
                    <i class="fas fa-moon" style="font-size: 0.938rem;"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Hidden file input for logo upload -->
    <input type="file" id="headerLogoUploadInput" accept="image/*" style="display: none;" onchange="handleHeaderLogoUpload(event)">


    <!-- Main Content -->
    <main style="height: calc(100vh - 6.5rem); display: flex; flex-direction: column; overflow: hidden;">
        <!-- Schedule View -->
        <div id="scheduleView" class="tab-content" style="display: flex; flex-direction: column; height: 100%; overflow: hidden;">
            <!-- Fixed Top Section - This stays pinned -->
            <div style="flex-shrink: 0; z-index: 50; background: var(--bg-primary); padding: 0.25rem 0.5rem;">
                <!-- Month/Year Header with + Button -->
                <div class="flex justify-between items-center mb-1 px-1">
                    <button onclick="showScheduleMenu()" class="p-1" style="background: transparent; visibility: hidden;">
                        <i class="fas fa-ellipsis-vertical" style="font-size: 0.75rem;"></i>
                    </button>
                    <h2 class="text-base font-bold cursor-pointer hover:opacity-70 transition-opacity text-center" id="currentMonthYear" onclick="toggleMonthView()"></h2>
                    <button class="p-1" style="background: transparent;" onclick="showScheduleMenu()" title="Add appointment">
                        <i class="fas fa-plus" style="color: var(--accent-primary); font-size: 0.688rem;"></i>
                    </button>
                </div>

                <!-- Collapsible Month View -->
                <div id="monthViewCollapse" class="hidden mb-2">
                    <div class="card" style="padding: 0.75rem;">
                        <div class="flex justify-between items-center mb-2">
                            <button onclick="previousMonth()" class="p-1.5 rounded-lg hover:bg-opacity-10" style="background: var(--bg-tertiary);">
                                <i class="fas fa-chevron-left" style="font-size: 0.75rem;"></i>
                            </button>
                            <h3 class="text-sm font-bold mono" id="calendarMonth"></h3>
                            <button onclick="nextMonth()" class="p-1.5 rounded-lg hover:bg-opacity-10" style="background: var(--bg-tertiary);">
                                <i class="fas fa-chevron-right" style="font-size: 0.75rem;"></i>
                            </button>
                        </div>

                        <div class="calendar-grid mb-1">
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Mon</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Tue</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Wed</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Thu</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Fri</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Sat</div>
                            <div class="text-center font-semibold p-1" style="color: var(--text-tertiary); font-size: 0.625rem;">Sun</div>
                        </div>

                        <div class="calendar-grid" id="calendarDays"></div>
                    </div>
                </div>

                <!-- Week Day Selector (Fixed) -->
                <div style="background: var(--bg-primary); padding: 0.25rem 0; border-bottom: 1px solid var(--border);">
                    <!-- Hidden week range for JS compatibility -->
                    <div id="weekRange" style="display: none;"></div>
                    <div style="display: flex; align-items: center; gap: 0.125rem; padding: 0 0.125rem; width: 100%; max-width: 100%;">
                        <button onclick="previousWeek()" class="week-nav-btn">
                            <i class="fas fa-chevron-left" style="font-size: 0.5rem;"></i>
                        </button>
                        <div class="week-days-nav" id="weekDaysNav" style="flex: 1; min-width: 0;"></div>
                        <button onclick="nextWeek()" class="week-nav-btn">
                            <i class="fas fa-chevron-right" style="font-size: 0.5rem;"></i>
                        </button>
                    </div>
                </div>

                <!-- Filter Icon & Today Button -->
                <div style="background: var(--bg-primary); padding: 0.25rem 0.5rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; gap: 0.25rem;">
                    <button onclick="showFilterMenu()" id="filterButton" class="uniform-tab" style="background: var(--bg-tertiary); color: var(--text-primary); display: flex; align-items: center; gap: 0.25rem;">
                        <i class="fas fa-filter" style="font-size: 0.5rem;"></i>
                        <span id="filterLabel">All</span>
                    </button>
                    <button onclick="jumpToToday()" class="uniform-tab" style="background: var(--accent-secondary); color: white; display: flex; align-items: center; gap: 0.25rem;">
                        <i class="fas fa-calendar-day" style="font-size: 0.5rem;"></i>Today
                    </button>
                    <!-- Zoom Controls -->
                    <div style="display: flex; align-items: center; gap: 0.25rem; margin-left: 0.5rem;">
                        <button onclick="zoomOut()" class="uniform-tab" style="background: var(--bg-tertiary); color: var(--text-primary); padding: 0.25rem 0.5rem; min-width: auto;">
                            <i class="fas fa-minus" style="font-size: 0.5rem;"></i>
                        </button>
                        <span id="zoomLevel" style="font-size: 0.625rem; min-width: 2rem; text-align: center;">100%</span>
                        <button onclick="zoomIn()" class="uniform-tab" style="background: var(--bg-tertiary); color: var(--text-primary); padding: 0.25rem 0.5rem; min-width: auto;">
                            <i class="fas fa-plus" style="font-size: 0.5rem;"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Scrollable Timeline Section -->
            <div id="timelineScrollContainer" style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; background: var(--bg-primary); min-height: 0;">
                <div class="day-timeline" id="dayTimeline" style="max-height: none; min-height: auto; overflow-y: visible;"></div>
            </div>
        </div>

        <!-- Clients View -->
        <div id="clientsView" class="tab-content hidden">
            <div style="position: sticky; top: 0; z-index: 50; background: var(--bg-primary); padding: 0.5rem;">
                <div class="flex justify-between items-center px-2 mb-3">
                    <button class="p-2" style="background: transparent; visibility: hidden;">
                        <i class="fas fa-plus" style="font-size: 0.75rem;"></i>
                    </button>
                    <h2 class="text-xl font-bold text-center">Clients & Pets</h2>
                    <button class="p-2" style="background: transparent;" onclick="showClientsMenu()" title="Client actions">
                        <i class="fas fa-plus" style="color: var(--accent-primary); font-size: 0.75rem;"></i>
                    </button>
                </div>
                <!-- Search Bar -->
                <div class="px-2">
                    <input type="text" id="clientSearch" placeholder="Search clients, pets, phone..." onkeyup="filterClients()" style="width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-secondary); font-size: 1.125rem; color: var(--text-primary);">
                </div>
            </div>

            <div style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 1rem;">
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="clientsList"></div>
            </div>
        </div>

        <!-- Services View -->
        <div id="servicesView" class="tab-content hidden">
            <div style="position: sticky; top: 0; z-index: 50; background: var(--bg-primary); padding: 0.5rem;">
                <div class="flex justify-between items-center px-2">
                    <button class="p-2" style="background: transparent; visibility: hidden;">
                        <i class="fas fa-plus" style="font-size: 0.75rem;"></i>
                    </button>
                    <h2 class="text-xl font-bold text-center">Services & Items</h2>
                    <button class="p-2" style="background: transparent;" onclick="showServicesMenu()" title="Add service or item">
                        <i class="fas fa-plus" style="color: var(--accent-primary); font-size: 0.75rem;"></i>
                    </button>
                </div>
                <!-- Filter Tabs -->
                <div class="flex justify-center gap-1 mt-2 px-2">
                    <button id="filterAll" onclick="filterServicesItems('all')" class="uniform-tab" style="background: var(--accent-primary); color: white;">
                        All
                    </button>
                    <button id="filterServices" onclick="filterServicesItems('service')" class="uniform-tab" style="background: var(--bg-tertiary); color: var(--text-secondary);">
                        Services
                    </button>
                    <button id="filterItems" onclick="filterServicesItems('item')" class="uniform-tab" style="background: var(--bg-tertiary); color: var(--text-secondary);">
                        Items
                    </button>
                </div>
            </div>

            <div style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 1rem;">
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="servicesList"></div>
            </div>
        </div>

        <!-- Waitlist View -->
        <div id="waitlistView" class="tab-content hidden">
            <div style="position: sticky; top: 0; z-index: 50; background: var(--bg-primary); padding: 0.5rem;">
                <div class="flex justify-between items-center px-2">
                    <button class="p-2" style="background: transparent; visibility: hidden;">
                        <i class="fas fa-plus" style="font-size: 0.75rem;"></i>
                    </button>
                    <h2 class="text-xl font-bold text-center">Waitlist</h2>
                    <button class="p-2" style="background: transparent;" onclick="openAddToWaitlistModal()">
                        <i class="fas fa-plus" style="color: var(--accent-primary); font-size: 0.75rem;"></i>
                    </button>
                </div>
            </div>

            <div style="flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 1rem;">
                <div id="waitlistContainer"></div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav id="bottomNav" style="position: fixed; bottom: env(safe-area-inset-bottom, 0); left: 0; right: 0; width: 100%; display: grid; grid-template-columns: repeat(4, 1fr); background: var(--bg-secondary); border-top: 1px solid var(--border); z-index: 10000; padding: 0.375rem 0;">
        <button id="tabSchedule" onclick="switchTab('schedule')" class="nav-tab" style="color: var(--accent-primary);">
            <i class="fas fa-calendar-week" style="font-size: 0.875rem;"></i>
            <span>Schedule</span>
        </button>
        <button id="tabClients" onclick="switchTab('clients')" class="nav-tab" style="color: var(--text-tertiary);">
            <i class="fas fa-users" style="font-size: 0.875rem;"></i>
            <span>Clients</span>
        </button>
        <button id="tabServices" onclick="switchTab('services')" class="nav-tab" style="color: var(--text-tertiary);">
            <i class="fas fa-scissors" style="font-size: 0.875rem;"></i>
            <span>Services</span>
        </button>
        <button id="tabWaitlist" onclick="switchTab('waitlist')" class="nav-tab" style="color: var(--text-tertiary);">
            <i class="fas fa-clock" style="font-size: 0.875rem;"></i>
            <span>Waitlist</span>
        </button>
    </nav>

    <script>
                // FIX 5: 
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // FIX: Enable Offline Storage (Prevents "Client is Offline" errors)
        db.enablePersistence({synchronizeTabs: true})
            .catch((err) => console.warn("Persistence failed:", err.code));

        // UI: Automated Sync Status (Updates header automatically)
        db.onSnapshotsInSync(() => {
            const statusEl = document.getElementById('syncStatus');
            if (statusEl) {
                statusEl.textContent = "Synced & Backed Up";
                statusEl.style.color = "var(--success)";
            }
            const lastBackupEl = document.getElementById('lastBackup');
            if (lastBackupEl) lastBackupEl.textContent = new Date().toLocaleTimeString();
        });

        // LOGIN UI: Secure Multi-User Login Screen
        function createLoginOverlay() {
            if (document.getElementById('loginOverlay')) return;
            const overlay = document.createElement('div');
            overlay.id = 'loginOverlay';
            overlay.style = "position:fixed;inset:0;z-index:99999;background:var(--bg-primary);display:flex;align-items:center;justify-content:center;padding:20px;";
            overlay.innerHTML = `
                <div class="card" style="width:100%;max-width:400px;text-align:center;padding:40px;border-radius:24px;">
                    <div style="width:80px;height:80px;background:var(--accent-primary);border-radius:20px;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;color:white;font-size:40px;">
                        <i class="fas fa-paw"></i>
                    </div>
                    <h2 style="font-size:24px;margin-bottom:10px;font-weight:700;">Maya Groom Pro</h2>
                    <p style="color:var(--text-secondary);margin-bottom:30px;">Sign in to securely access your data from any device.</p>
                    <button onclick="handleLogin()" class="btn btn-primary" style="width:100%;padding:16px;font-size:18px;">
                        <i class="fab fa-google mr-2"></i> Sign in with Google
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // LOGIN ACTION: Using Redirect (Better for Mobile/iPhones)
        async function handleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithRedirect(provider);
            } catch (e) {
                alert("Login failed: " + e.message);
            }
        }

        // DATA GUARD: Ensures users only see their own appointments
        auth.onAuthStateChanged((user) => {
            if (user) {
                const loginScreen = document.getElementById('loginOverlay');
                if (loginScreen) loginScreen.remove();
                
                // Start your existing app functions
                renderDayTimeline();
                renderClients();
                renderCalendar();
            } else {
                createLoginOverlay();
            }
        });
    </script>
</body>
</html>